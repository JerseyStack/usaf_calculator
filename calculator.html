function calculateScore() {
  const output = document.getElementById("output");

  // ===============================
  // Basic inputs
  // ===============================
  const gender = document.getElementById("gender").value;
  const age = Number(document.getElementById("age").value);

  if (!age || age < 17) {
    output.textContent = "Please enter a valid age.";
    return;
  }

  const bracket = ageToBracket(age);
  const data = PT_DATA[gender][bracket];

  if (!data) {
    output.textContent = "No PT data found for this age group.";
    return;
  }

  // ===============================
  // Component selections
  // ===============================
  const cardioType = document.querySelector('input[name="cardio"]:checked')?.value;
  const upperType  = document.querySelector('input[name="upper"]:checked')?.value;
  const coreType   = document.querySelector('input[name="core"]:checked')?.value;

  if (!cardioType || !upperType || !coreType) {
    output.textContent = "Please select one option for each category.";
    return;
  }

  // ===============================
  // Raw values
  // ===============================
  const cardioVal = document.getElementById("cardio-input").value;
  const upperVal  = document.getElementById("upper-input").value;
  const coreVal   = document.getElementById("core-input").value;

  const waist  = Number(document.getElementById("waist").value);
  const height = Number(document.getElementById("height").value);

  if (!cardioVal || !upperVal || !coreVal || !waist || !height) {
    output.textContent = "Please fill out all fields.";
    return;
  }

  // ===============================
  // Scoring
  // ===============================
  let total = 0;

  // Cardio
  const cardioScore = scoreFromTable(
    data[cardioType],
    cardioVal,
    cardioType === "run"
  );
  total += cardioScore;

  // Upper body
  const upperScore = scoreFromTable(
    data[upperType],
    upperVal
  );
  total += upperScore;

  // Core
  const coreScore = scoreFromTable(
    data[coreType],
    coreVal,
    coreType === "plank"
  );
  total += coreScore;

  // WHtR
  const whtr = +(waist / height).toFixed(2);
  const whtrScore = scoreFromTable(PT_DATA.whtr, whtr);
  total += whtrScore;

  // ===============================
  // Pass / Fail
  // ===============================
  const pass =
    total >= PT_DATA.compositeCategories.satisfactoryMin;

  // ===============================
  // Output
  // ===============================
  output.innerHTML = `
    <h3>Total Score: ${total.toFixed(1)}</h3>
    <strong>Status:</strong>
    <span style="color:${pass ? "green" : "red"}">
      ${pass ? "PASS" : "FAIL"}
    </span>
    <hr>
    <ul>
      <li>Cardio (${cardioType}): ${cardioScore.toFixed(1)}</li>
      <li>Upper (${upperType}): ${upperScore.toFixed(1)}</li>
      <li>Core (${coreType}): ${coreScore.toFixed(1)}</li>
      <li>Waist-to-Height Ratio: ${whtrScore.toFixed(1)}</li>
    </ul>
  `;
}
