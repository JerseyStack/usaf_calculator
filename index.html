<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>USAF PT Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {font-family:Arial,Helvetica,sans-serif;margin:0;padding:0 1rem;background:#f2f2f2;}
  .wrapper {max-width:800px;margin:2rem auto;background:#fff;padding:1.5rem;
           border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.15);}
  h1 {text-align:center;margin-bottom:1.5rem;}
  form {display:flex;flex-direction:column;gap:1.5rem;}
  fieldset {border:1px solid #999;padding:1rem;border-radius:5px;}
  legend {font-weight:bold;padding:0 .5rem;}
  label {display:flex;flex-direction:column;font-weight:600;}
  .radio-group {display:flex;flex-wrap:wrap;gap:.5rem 1.5rem;margin-bottom:1rem;}
  .input-group {margin-top:.5rem;}
  input[type="text"], input[type="number"], select, button {
    width:100%;padding:.6rem;font-size:1rem;
    border:1px solid #999;border-radius:4px;box-sizing:border-box;
  }
  button {background:#005A9C;color:#fff;cursor:pointer;font-weight:600;margin-top:1rem;}
  button:hover {background:#003087;}
  .result {margin-top:2rem;padding:1rem;border:2px solid #444;background:#fafafa;border-radius:5px;}
  .pass {color:#006400;font-weight:bold;}
  .fail {color:#C8102E;font-weight:bold;}
  @media (max-width:400px){
    h1{font-size:1.5rem}
    select,button,input{font-size:.95rem}
  }
</style>
</head>
<body>
<div class="wrapper">
  <h1>USAF PT Calculator</h1>
  <form id="ptForm">
    <!-- ====================== DEMOGRAPHICS ====================== -->
    <fieldset>
      <legend>Demographics</legend>
      <label>Gender
        <select id="gender" required>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </label>
      <label>Age (years)
        <input type="number" id="age" min="17" max="80" required placeholder="e.g., 27" inputmode="numeric">
      </label>
    </fieldset>

    <!-- ====================== COMPONENTS ====================== -->
    <fieldset>
      <legend>Cardio Component</legend>
      <div class="radio-group">
          <label><input type="radio" name="cardio" value="run" checked> 2‑Mile Run</label>
          <label><input type="radio" name="cardio" value="hamr"> HAMR Shuttle</label>
      </div>
      <div class="input-group">
        <label id="cardio-label">Run Time (mm:ss)</label>
        <input type="text" id="cardio-input" placeholder="e.g., 14:30" inputmode="tel" required>
      </div>
    </fieldset>

    <fieldset>
      <legend>Upper-Body Component</legend>
      <div class="radio-group">
        <label><input type="radio" name="upper" value="pushups" checked> Push‑ups (1 min)</label>
        <label><input type="radio" name="upper" value="handRelease"> Hand-Release Push‑ups (2 min)</label>
      </div>
      <div class="input-group">
        <label>Repetitions</label>
        <input type="number" id="upper-input" placeholder="e.g., 45" inputmode="numeric" required>
      </div>
    </fieldset>

    <fieldset>
      <legend>Core Component</legend>
      <div class="radio-group">
        <label><input type="radio" name="core" value="situps" checked> Sit‑ups (1 min)</label>
        <label><input type="radio" name="core" value="crunch"> Cross-Leg Reverse Crunch (2 min)</label>
        <label><input type="radio" name="core" value="plank"> Forearm Plank</label>
      </div>
      <div class="input-group">
        <label id="core-label">Repetitions</label>
        <input type="text" id="core-input" placeholder="e.g., 50" inputmode="numeric" required>
      </div>
    </fieldset>

    <fieldset>
      <legend>Waist-to-Height Ratio (WHtR)</legend>
      <label>Waist (inches)
        <input type="number" id="waist" min="10" max="80" step="0.1" required placeholder="e.g., 34" inputmode="numeric">
      </label>
      <label>Height (inches)
        <input type="number" id="height" min="48" max="84" step="0.1" required placeholder="e.g., 70" inputmode="numeric">
      </label>
    </fieldset>

    <button type="submit">Calculate Score</button>
  </form>
  <div id="output" class="result" style="display:none;"></div>
</div>

<script>

  const PT_DATA = {
  "male": {
    "<25": {
      "run": { "13:25": 50, "13:55": 49.4, "14:12": 48.8, "14:27": 48.1, "14:41": 47.5, "15:05": 46.9, "15:17": 46.3, "15:28": 45.6, "15:38": 45, "16:09": 43.9, "16:29": 42.9, "16:49": 41.8, "17:08": 40.7, "17:18": 39.6, "17:37": 38.6, "17:55": 37.5, "18:23": 35.5, "18:39": 34, "19:07": 32.5, "19:36": 31, "19:45": 29.5 },
      "hamr": { "100": 50, "94": 49.4, "90": 48.8, "86": 48.1, "82": 47.5, "78": 46.9, "74": 46.3, "70": 45.6, "66": 45, "62": 43.9, "58": 42.9, "54": 41.8, "50": 40.7, "48": 39.6, "46": 38.6, "44": 37.5, "42": 35.5, "40": 34, "38": 32.5, "36": 31, "34": 29.5 },
      "pushups": { "67": 15, "64": 14.6, "62": 14.3, "60": 14, "58": 13.7, "55": 13.2, "52": 12.8, "50": 12.5, "47": 12, "45": 11.6, "42": 10.8, "40": 10.2, "37": 9, "34": 8, "33": 7.5, "32": 5.3, "31": 3, "30": 0.8 },
      "handRelease": { "40": 15, "38": 14.4, "36": 13.8, "34": 13.2, "32": 12.6, "30": 12, "28": 11.4, "26": 10.8, "24": 10.2, "22": 9.6, "20": 9, "18": 8.4, "16": 7.8, "15": 7.5 },
      "situps": { "58": 15, "55": 14.3, "52": 13.5, "50": 13.1, "48": 12.5, "46": 11.3, "44": 9.8, "42": 9, "40": 4.5, "39": 2.3 },
      "crunch": { "49": 15, "46": 14.2, "44": 13.7, "42": 13.2, "40": 12.6, "38": 12.1, "36": 11.6, "34": 11, "32": 10.5, "30": 9.9, "28": 9.4, "26": 8.9, "24": 8.4, "22": 7.8, "21": 7.5 },
      "plank": { "3:35": 15, "3:20": 14.5, "3:05": 13.5, "2:45": 12.6, "2:25": 11.5, "2:05": 10.5, "1:55": 10, "1:25": 8.5, "1:05": 7.5 }
    },
    "25-29": {
        "run": { "13:34": 50, "14:24": 49.4, "14:38": 48.8, "14:50": 48.1, "15:02": 47.5, "15:24": 46.9, "15:34": 46.3, "15:44": 45.6, "15:53": 45, "16:15": 43.9, "16:34": 42.9, "16:53": 41.8, "17:11": 40.7, "17:28": 39.6, "17:45": 38.6, "18:01": 37.5, "18:22": 35.5, "18:51": 34, "19:18": 32.5, "19:59": 31, "20:31": 29.5 },
        "hamr": { "96": 50, "90": 49.4, "87": 48.8, "83": 48.1, "80": 47.5, "77": 46.9, "74": 46.3, "71": 45.6, "68": 45, "65": 43.9, "62": 42.9, "59": 41.8, "56": 40.7, "54": 39.6, "51": 38.6, "48": 37.5, "45": 35.5, "42": 34, "39": 32.5, "36": 31, "33": 29.5 },
        "pushups": { "64": 15, "62": 14.7, "60": 14.4, "58": 14.1, "56": 13.8, "54": 13.5, "52": 13.2, "50": 12.9, "48": 12.6, "46": 12.3, "44": 12, "42": 11.7, "40": 11.4, "38": 11.1, "36": 10.8, "34": 10.5, "32": 10.2, "30": 9.9, "28": 9.6, "26": 9.3, "24": 9, "22": 8.7, "20": 8.4, "18": 8.1, "16": 7.8, "15": 7.5, "14": 5.3, "13": 3, "12": 0.8 },
        "handRelease": { "40": 15, "38": 14.4, "36": 13.8, "34": 13.2, "32": 12.6, "30": 12, "28": 11.4, "26": 10.8, "24": 10.2, "22": 9.6, "20": 9, "18": 8.4, "16": 7.8, "15": 7.5 },
        "situps": { "56": 15, "54": 14.6, "52": 14.3, "50": 13.2, "48": 12.8, "46": 12.4, "44": 12.2, "42": 11.6, "40": 11.2, "38": 10.8, "36": 10.4, "34": 10, "32": 9.6, "30": 9.2, "28": 8.8, "26": 8.4, "24": 8, "22": 7.6, "20": 7.2, "18": 6.8, "16": 6.4, "14": 6, "12": 5.6, "10": 5.2, "8": 4.8, "6": 4.4, "4": 4, "2": 3.6, "0": 3.2 },
        "crunch": { "49": 15, "46": 14.2, "44": 13.7, "42": 13.2, "40": 12.6, "38": 12.1, "36": 11.6, "34": 11, "32": 10.5, "30": 9.9, "28": 9.4, "26": 8.9, "24": 8.4, "22": 7.8, "21": 7.5 },
        "plank": { "3:25": 15, "3:15": 14.5, "3:02": 13.9, "2:55": 13.5, "2:35": 12.5, "2:15": 11.5, "1:55": 10.5, "1:35": 9.5, "1:15": 8.5, "0:55": 7.5 }
    },
    "30-34": {
      "run": { "13:42": 50, "14:32": 49.4, "14:46": 48.8, "14:59": 48.1, "15:10": 47.5, "15:32": 46.9, "15:42": 46.3, "15:52": 45.6, "16:01": 45, "16:29": 43.9, "16:48": 42.9, "17:06": 41.8, "17:24": 40.7, "17:41": 39.6, "17:58": 38.6, "18:14": 37.5, "18:35": 35.5, "19:04": 34, "19:31": 32.5, "20:12": 31, "20:44": 29.5 },
      "hamr": { "92": 50, "87": 49.4, "83": 48.8, "80": 48.1, "77": 47.5, "74": 46.9, "71": 46.3, "68": 45.6, "65": 45, "62": 43.9, "59": 42.9, "56": 41.8, "54": 40.7, "51": 39.6, "48": 38.6, "45": 37.5, "42": 35.5, "39": 34, "36": 32.5, "33": 31, "30": 29.5 },
      "pushups": { "57": 15, "55": 14.7, "53": 14.4, "51": 14.1, "49": 13.9, "47": 13.7, "45": 13.4, "43": 13.1, "41": 12.8, "40": 12.5, "38": 11.7, "36": 11.3, "34": 10.5, "32": 10.1, "30": 9, "28": 8, "27": 7.5, "26": 5.3, "25": 3, "24": 0.8 },
      "handRelease": { "40": 15, "38": 14.4, "36": 13.8, "34": 13.2, "32": 12.6, "30": 12, "28": 11.4, "26": 10.8, "24": 10.2, "22": 9.6, "20": 9, "18": 8.4, "16": 7.8, "15": 7.5 },
      "situps": { "54": 15, "51": 14.3, "49": 13.8, "47": 13.2, "45": 12.8, "43": 12, "41": 10.5, "39": 9, "37": 4.5, "36": 2.3 },
      "crunch": { "47": 15, "45": 14.5, "43": 14, "41": 13.4, "39": 12.8, "37": 12.1, "35": 11.3, "33": 10.8, "31": 10.4, "29": 10.2, "27": 9.7, "25": 9.4, "23": 8.9, "21": 8.3, "19": 7.5 },
      "plank": { "3:25": 15, "3:15": 14.5, "3:02": 13.9, "2:55": 13.5, "2:35": 12.5, "2:15": 11.5, "1:55": 10.5, "1:35": 9.5, "1:15": 8.5, "0:55": 7.5 }
    },
    "35-39": {
      "run": { "14:05": 50, "14:45": 49.4, "14:59": 48.8, "15:12": 48.1, "15:24": 47.5, "15:45": 46.9, "15:55": 46.3, "16:05": 45.6, "16:15": 45, "16:43": 43.9, "17:01": 42.9, "17:19": 41.8, "17:37": 40.7, "17:56": 39.6, "18:15": 38.6, "18:35": 37.5, "18:55": 35.5, "19:36": 34, "20:10": 32.5, "21:09": 31, "22:04": 29.5 },
      "hamr": { "88": 50, "83": 49.4, "80": 48.8, "77": 48.1, "74": 47.5, "71": 46.9, "68": 46.3, "65": 45.6, "62": 45, "59": 43.9, "56": 42.9, "54": 41.8, "51": 40.7, "48": 39.6, "45": 38.6, "42": 37.5, "39": 35.5, "36": 34, "33": 32.5, "30": 31, "27": 29.5 },
      "pushups": { "51": 15, "48": 14.1, "46": 13.9, "44": 13.7, "42": 13.4, "40": 13.1, "38": 12.8, "36": 12.5, "34": 11.6, "32": 11, "30": 10.2, "28": 9.8, "26": 8.3, "24": 7.5, "23": 5.3, "22": 3, "21": 0.8 },
      "handRelease": { "40": 15, "38": 14.4, "36": 13.8, "34": 13.2, "32": 12.6, "30": 12, "28": 11.4, "26": 10.8, "24": 10.2, "22": 9.6, "20": 9, "18": 8.4, "16": 7.8, "15": 7.5 },
      "situps": { "52": 15, "49": 14.3, "47": 13.8, "45": 13.2, "43": 12.8, "41": 12, "39": 10.5, "37": 9, "35": 4.5, "34": 2.3 },
      "crunch": { "46": 15, "44": 14.5, "42": 14, "40": 13.4, "38": 12.8, "36": 12.1, "34": 11.6, "32": 11.3, "30": 10.7, "28": 10.2, "26": 9.9, "24": 9.4, "22": 8.9, "20": 8.3, "18": 7.5 },
      "plank": { "3:20": 15, "3:10": 14.5, "2:57": 13.9, "2:50": 13.5, "2:30": 12.5, "2:10": 11.5, "1:50": 10.5, "1:30": 9.5, "1:10": 8.5, "0:50": 7.5 }
    },
    // ... other male brackets ...
  },
  "female": {
    "<25": {
        "run": { "15:30": 50, "15:55": 49.4, "16:00": 48.8, "16:04": 48.1, "16:27": 47.5, "17:03": 46.9, "17:17": 46.3, "17:31": 45.6, "17:44": 45, "18:18": 43.9, "18:38": 42.9, "18:58": 41.8, "19:16": 40.7, "19:34": 39.6, "19:52": 38.6, "20:12": 37.5, "20:57": 35.5, "21:40": 34, "22:07": 32.5, "22:37": 31, "22:45": 29.5 },
        "hamr": { "83": 50, "77": 49.4, "74": 48.8, "71": 48.1, "68": 47.5, "65": 46.9, "62": 46.3, "59": 45.6, "56": 45, "54": 43.9, "51": 42.9, "48": 41.8, "45": 40.7, "42": 39.6, "39": 38.6, "36": 37.5, "33": 35.5, "30": 34, "28": 32.5, "26": 31, "24": 29.5 },
        "pushups": { "50": 15, "48": 14.7, "46": 14.4, "44": 14.1, "42": 13.8, "40": 13.5, "38": 13.2, "36": 12.9, "34": 12.6, "32": 12.3, "30": 12, "28": 11.7, "26": 11.4, "24": 11.1, "22": 10.8, "20": 10.5, "18": 10.2, "16": 9.9, "14": 9.6, "12": 9.3, "10": 9, "8": 8.7, "6": 8.4, "4": 8.1, "3": 7.5, "2": 5.3, "1": 3, "0": 0.8 },
        "handRelease": { "33": 15, "31": 14.4, "29": 13.8, "27": 13.2, "25": 12.6, "23": 12, "21": 11.4, "19": 10.8, "17": 10.2, "15": 9.6, "13": 9, "11": 8.4, "9": 7.8, "8": 7.5 },
        "situps": { "53": 15, "51": 14.6, "49": 14.3, "47": 13.8, "45": 13.4, "43": 12.9, "41": 12.5, "39": 12, "37": 11.3, "35": 10.5, "33": 9.8, "31": 9, "29": 4.5, "28": 2.3 },
        "crunch": { "46": 15, "44": 14.6, "42": 14.2, "40": 13.7, "38": 13.4, "36": 12.9, "34": 12.5, "32": 12.1, "30": 11.7, "28": 11.2, "26": 10.8, "24": 10.3, "22": 9.9, "20": 9.4, "18": 9, "16": 8.5, "14": 8.1, "12": 7.7, "11": 7.5 },
        "plank": { "3:25": 15, "3:15": 14.5, "3:05": 13.8, "2:45": 12.8, "2:25": 11.9, "2:05": 10.9, "1:45": 9.9, "1:25": 8.9, "1:05": 8, "1:00": 7.7, "0:55": 7.5 }
    },
    "25-29": {
        "run": { "15:48": 50, "16:36": 49.4, "16:54": 48.8, "17:09": 48.1, "17:23": 47.5, "17:48": 46.9, "17:59": 46.3, "18:10": 45.6, "18:21": 45, "18:50": 43.9, "19:09": 42.9, "19:27": 41.8, "19:45": 40.7, "20:01": 39.6, "20:17": 38.6, "20:33": 37.5, "21:05": 35.5, "21:29": 34, "21:55": 32.5, "22:24": 31, "22:50": 29.5 },
        "hamr": { "80": 50, "74": 49.4, "71": 48.8, "68": 48.1, "65": 47.5, "62": 46.9, "59": 46.3, "56": 45.6, "54": 45, "51": 43.9, "48": 42.9, "45": 41.8, "42": 40.7, "40": 39.6, "38": 38.6, "36": 37.5, "34": 35.5, "32": 34, "30": 32.5, "28": 31, "26": 29.5 },
        "pushups": { "47": 15, "44": 14.6, "42": 14.3, "40": 14, "38": 13.7, "36": 13.4, "34": 12.9, "32": 12.6, "30": 12.3, "28": 12, "26": 11, "24": 10.5, "22": 9.5, "20": 8.7, "18": 8, "17": 7.5, "16": 5.3, "15": 3, "14": 0.8 },
        "handRelease": { "31": 15, "29": 14.4, "27": 13.8, "25": 13.2, "23": 12.6, "21": 12, "19": 11.4, "17": 10.8, "15": 10.2, "13": 9.6, "11": 9, "9": 8.4, "7": 7.8, "6": 7.5 },
        "situps": { "50": 15, "48": 14.3, "46": 13.5, "44": 12.9, "42": 12, "40": 11.3, "38": 10.5, "36": 9.8, "34": 9, "32": 4.5, "31": 2.3 },
        "crunch": { "45": 15, "43": 14.6, "41": 14.2, "39": 13.7, "37": 13.4, "35": 12.9, "33": 12.5, "31": 12.1, "29": 11.7, "27": 11.3, "25": 10.8, "23": 10.4, "21": 10, "19": 9.6, "17": 9.2, "15": 8.8, "13": 8.3, "11": 8, "9": 7.5 },
        "plank": { "3:25": 15, "3:14": 14.7, "3:00": 14.3, "2:40": 12.7, "2:20": 12.2, "2:00": 11.6, "1:40": 10, "1:20": 9.4, "1:00": 8.9, "0:50": 7.5 }
    },
    "30-34": {
      "run": { "15:51": 50, "16:42": 49.4, "16:59": 48.8, "17:14": 48.1, "17:28": 47.5, "17:53": 46.9, "18:04": 46.3, "18:15": 45.6, "18:25": 45, "18:54": 43.9, "19:13": 42.9, "19:31": 41.8, "19:49": 40.7, "20:05": 39.6, "20:21": 38.6, "20:37": 37.5, "21:08": 35.5, "21:32": 34, "21:58": 32.5, "22:27": 31, "22:59": 29.5 },
      "hamr": { "74": 50, "68": 49.4, "65": 48.8, "62": 48.1, "59": 47.5, "56": 46.9, "54": 46.3, "51": 45.6, "48": 45, "45": 43.9, "42": 42.9, "39": 41.8, "36": 40.7, "33": 39.6, "30": 38.6, "27": 37.5, "24": 35.5, "22": 34, "20": 32.5, "18": 31, "16": 29.5 },
      "pushups": { "46": 15, "44": 14.8, "42": 14.6, "40": 14.3, "38": 14.1, "36": 13.8, "34": 13.5, "32": 13.2, "30": 13, "28": 12.8, "26": 12.5, "24": 12.3, "22": 11.9, "20": 11.4, "18": 10.5, "16": 9.8, "15": 9, "14": 7.5, "13": 5.3, "12": 3, "11": 0.8 },
      "handRelease": { "31": 15, "29": 14.4, "27": 13.8, "25": 13.2, "23": 12.6, "21": 12, "19": 11.4, "17": 10.8, "15": 10.2, "13": 9.6, "11": 9, "9": 8.4, "7": 7.8, "6": 7.5 },
      "situps": { "45": 15, "43": 14.6, "41": 14.1, "39": 13.5, "37": 13.1, "35": 12.3, "33": 11.3, "31": 10.2, "29": 9, "27": 4.5, "26": 2.3 },
      "crunch": { "44": 15, "42": 14.6, "40": 14.2, "38": 13.7, "36": 13.3, "34": 12.8, "32": 12.5, "30": 12, "28": 11.6, "26": 11.2, "24": 10.7, "22": 10.3, "20": 9.8, "18": 9.5, "16": 9, "14": 8.6, "12": 8.2, "10": 7.7, "9": 7.5 },
      "plank": { "3:20": 15, "3:09": 14.5, "2:55": 13.8, "2:35": 12.8, "2:15": 11.9, "1:55": 10.9, "1:35": 9.9, "1:15": 8.9, "0:55": 8, "0:45": 7.5 }
    },
    "35-39": {
      "run": { "16:00": 50, "16:52": 49.4, "17:10": 48.8, "17:25": 48.1, "17:39": 47.5, "18:04": 46.9, "18:16": 46.3, "18:26": 45.6, "18:37": 45, "19:07": 43.9, "19:25": 42.9, "19:44": 41.8, "20:01": 40.7, "20:18": 39.6, "20:34": 38.6, "20:50": 37.5, "21:22": 35.5, "21:46": 34, "22:12": 32.5, "22:42": 31, "23:15": 29.5 },
      "hamr": { "71": 50, "65": 49.4, "62": 48.8, "59": 48.1, "56": 47.5, "54": 46.9, "51": 46.3, "48": 45.6, "45": 45, "42": 43.9, "39": 42.9, "36": 41.8, "33": 40.7, "30": 39.6, "27": 38.6, "24": 37.5, "22": 35.5, "19": 34, "17": 32.5, "15": 31, "13": 29.5 },
      "pushups": { "42": 15, "40": 14.6, "38": 14.3, "36": 13.9, "34": 13.7, "32": 13.4, "30": 13.1, "28": 12.8, "26": 12.5, "24": 12, "22": 11.7, "20": 11.4, "18": 10.5, "16": 9.8, "14": 7.5, "13": 5.3, "12": 3, "11": 0.8 },
      "handRelease": { "31": 15, "29": 14.4, "27": 13.8, "25": 13.2, "23": 12.6, "21": 12, "19": 11.4, "17": 10.8, "15": 10.2, "13": 9.6, "11": 9, "9": 8.4, "7": 7.8, "6": 7.5 },
      "situps": { "43": 15, "41": 14.6, "39": 14.1, "37": 13.5, "35": 13.1, "33": 12.3, "31": 11.3, "29": 10.2, "27": 9, "25": 4.5, "24": 2.3 },
      "crunch": { "43": 15, "41": 14.6, "39": 14.2, "37": 13.6, "35": 13.3, "33": 12.9, "31": 12.5, "29": 12.1, "27": 11.7, "25": 11.3, "23": 10.8, "21": 10.4, "19": 10, "17": 9.6, "15": 9.2, "13": 8.8, "11": 8.3, "9": 8, "7": 7.5 },
      "plank": { "3:15": 15, "3:04": 14.5, "2:50": 13.8, "2:30": 12.8, "2:10": 11.9, "1:50": 10.9, "1:30": 9.9, "1:10": 8.9, "0:50": 8, "0:45": 7.7 }
    },
    // ... other female brackets ...
  },
  "whtr": { "0.49": 20, "0.50": 19, "0.51": 18, "0.52": 17, "0.53": 16, "0.54": 15, "0.55": 12.5, "0.56": 10, "0.57": 7.5, "0.58": 5, "0.59": 2.5, "0.60": 0 },
  "minimumComponentValues": {
    "run": 29.5, "hamr": 29.5, "pushups": 0.8, "handRelease": 7.5, "situps": 2.3, "crunch": 7.5, "plank": 7.5, "whtr": 0
  },
  "compositeCategories": {
    "excellentMin": 90, "satisfactoryMin": 75
  }
};
  
// ========================================================================
// DATA LOADING
// ========================================================================
let PT_DATA = null;
fetch('usaf_pt_charts_clean.json')
  .then(response => {
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    return response.json();
  })
  .then(data => {
    PT_DATA = data;
    console.log('✅ USAF PT data loaded successfully.');
  })
  .catch(error => {
    console.error('❌ Failed to load or parse PT data:', error);
    alert('CRITICAL ERROR: Could not load PT data file. The calculator cannot function. Check the console for details.');
  });

// ========================================================================
// HELPER FUNCTIONS
// ========================================================================
const mmssToSec = str => { const [m = 0, s = 0] = str.split(':').map(Number); return m * 60 + s; };
const getAgeBucket = age => {
  if (age < 25) return "<25"; if (age <= 29) return "25-29";
  if (age <= 34) return "30-34"; if (age <= 39) return "35-39";
  if (age <= 44) return "40-44"; if (age <= 49) return "45-49";
  if (age <= 54) return "50-54"; if (age <= 59) return "55-59";
  return "60+";
};

// ========================================================================
// SCORE LOOKUP LOGIC
// ========================================================================
const lookupNumeric = (table, value) => {
  if (!table || isNaN(value)) return 0;
  const tiers = Object.keys(table).map(Number).sort((a, b) => b - a);
  for (const tier of tiers) { if (value >= tier) return table[tier]; }
  return 0;
};
const lookupRunTime = (table, userTimeSec) => {
  if (!table || isNaN(userTimeSec)) return 0;
  const tiers = Object.keys(table).map(time => [mmssToSec(time), table[time]]).sort((a, b) => a[0] - b[0]);
  for (const [tierSec, points] of tiers) { if (userTimeSec <= tierSec) return points; }
  return 0;
};
const lookupWhtr = (waist, height) => {
    if (height === 0 || !PT_DATA.whtr) return { pts: 0, ratio: "N/A", category: "Invalid Height" };
    const ratio = (waist / height).toFixed(2);
    const WHTR_TABLE = PT_DATA.whtr;
    const tiers = Object.keys(WHTR_TABLE).map(Number).sort((a, b) => a - b);
    for (const tier of tiers) {
        if (ratio <= tier) {
            const category = ratio <= 0.49 ? "Low Risk" : ratio < 0.55 ? "Moderate Risk" : "High Risk";
            return { pts: WHTR_TABLE[tier.toFixed(2)], ratio, category };
        }
    }
    return { pts: 0, ratio, category: "High Risk" };
};

// ========================================================================
// DYNAMIC UI UPDATES & INPUT FORMATTING (RESTORED SECTION)
// ========================================================================
const handleTimeInput = (event) => {
    const input = event.target;
    let isTimeField = (input.id === 'cardio-input' && document.querySelector('input[name="cardio"]:checked').value === 'run') ||
                      (input.id === 'core-input' && document.querySelector('input[name="core"]:checked').value === 'plank');

    if (isTimeField) {
        const digits = input.value.replace(/\D/g, '').substring(0, 4);
        let formattedValue = digits;
        if (digits.length > 2) {
            formattedValue = `${digits.substring(0, 2)}:${digits.substring(2)}`;
        }
        input.value = formattedValue;
    }
};

const updateInputLabel = (radioName, mappings) => {
    document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
        radio.addEventListener('change', (e) => {
            const config = mappings[e.target.value];
            const labelEl = document.getElementById(`${radioName}-label`);
            const inputEl = document.getElementById(`${radioName}-input`);
            if (labelEl) labelEl.textContent = config.label;
            if (inputEl) {
                inputEl.placeholder = config.placeholder;
                inputEl.value = '';
                inputEl.inputmode = config.inputmode;
                inputEl.type = (config.inputmode === 'numeric') ? 'number' : 'text';
            }
        });
    });
};

// Attach event listeners
document.addEventListener('DOMContentLoaded', () => {
    updateInputLabel('cardio', {
        run:  { label: 'Run Time (mm:ss)', placeholder: 'e.g., 14:30', inputmode: 'tel'},
        hamr: { label: 'HAMR Shuttles', placeholder: 'e.g., 65', inputmode: 'numeric'}
    });
    updateInputLabel('core', {
        situps:  { label: 'Repetitions', placeholder: 'e.g., 50', inputmode: 'numeric' },
        crunch:  { label: 'Repetitions', placeholder: 'e.g., 40', inputmode: 'numeric' },
        plank:   { label: 'Plank Time (mm:ss)', placeholder: 'e.g., 2:15', inputmode: 'tel' }
    });

    document.getElementById('cardio-input').addEventListener('input', handleTimeInput);
    document.getElementById('core-input').addEventListener('input', handleTimeInput);
});


// ========================================================================
// FORM SUBMISSION & CALCULATION
// ========================================================================
document.getElementById('ptForm').addEventListener('submit', (e) => {
  e.preventDefault();
  if (!PT_DATA) {
    alert('Data is not loaded yet. Please wait a moment and try again.');
    return;
  }

  // --- GET USER INPUT & CHOICES ---
  const gender = document.getElementById('gender').value;
  const age = parseInt(document.getElementById('age').value, 10);
  const waist = parseFloat(document.getElementById('waist').value);
  const height = parseFloat(document.getElementById('height').value);
  
  const cardioChoice = document.querySelector('input[name="cardio"]:checked').value;
  const upperChoice = document.querySelector('input[name="upper"]:checked').value;
  const coreChoice = document.querySelector('input[name="core"]:checked').value;

  const cardioInput = document.getElementById('cardio-input').value;
  const upperInput = parseInt(document.getElementById('upper-input').value, 10);
  const coreInput = document.getElementById('core-input').value;

  // --- VALIDATE INPUT ---
  if (isNaN(age) || isNaN(waist) || isNaN(height)) {
    return alert('Please fill out all Age, Waist, and Height fields with valid numbers.');
  }
  const bucket = getAgeBucket(age);
  const bucketData = PT_DATA[gender]?.[bucket];
  if (!bucketData) {
    return alert(`Sorry, scoring data for the ${gender}, age ${age} bracket is not available in the JSON file.`);
  }

  // --- CALCULATE POINTS ---
  let cardioPts = 0, cardioDisplay = cardioInput;
  if (cardioChoice === 'run') {
      if (!/^\d{1,2}:\d{2}$/.test(cardioInput)) return alert('Run time must be in mm:ss format.');
      cardioPts = lookupRunTime(bucketData.run, mmssToSec(cardioInput));
  } else {
      cardioPts = lookupNumeric(bucketData.run, parseInt(cardioInput, 10)); // HAMR uses run table points
      cardioDisplay = `${parseInt(cardioInput, 10)} shuttles`;
  }
  
  const upperPts = lookupNumeric(bucketData[upperChoice], upperInput);

  let corePts = 0, coreDisplay = coreInput;
  if (coreChoice === 'plank') {
    if (!/^\d{1,2}:\d{2}$/.test(coreInput)) return alert('Plank time must be in mm:ss format.');
    corePts = lookupRunTime(bucketData.plank, mmssToSec(coreInput));
    coreDisplay = coreInput;
  } else {
    corePts = lookupNumeric(bucketData[coreChoice], parseInt(coreInput, 10));
    coreDisplay = `${parseInt(coreInput, 10)} reps`;
  }

  const whtrInfo = lookupWhtr(waist, height);

  // --- CALCULATE TOTAL & CHECK MINIMUMS ---
  const totalScore = (cardioPts || 0) + (upperPts || 0) + (corePts || 0) + (whtrInfo.pts || 0);
  const mins = PT_DATA.minimumComponentValues;
  
  const passedCardio = cardioPts >= mins.run;
  const passedUpper = upperPts >= mins[upperChoice];
  const passedCore = corePts >= mins[coreChoice];
  const passedWhtr = whtrInfo.pts >= mins.whtr;
  const passedComposite = totalScore >= PT_DATA.compositeCategories.satisfactoryMin;

  const isPass = passedCardio && passedUpper && passedCore && passedWhtr && passedComposite;

  // --- DISPLAY RESULTS ---
  const getResultLine = (label, display, points, passed) =>
    `<p>${label} (${display}): <strong>${(points || 0).toFixed(1)} pts</strong> ${passed ? '✅' : '❌'}</p>`;

  const outputDiv = document.getElementById('output');
  outputDiv.style.display = 'block';
  outputDiv.innerHTML = `
    <h2>Result (${gender.charAt(0).toUpperCase() + gender.slice(1)}, Age ${age})</h2>
    ${getResultLine(cardioChoice === 'run' ? '2-Mile Run' : 'HAMR Shuttle', cardioDisplay, cardioPts, passedCardio)}
    ${getResultLine(upperChoice === 'pushups' ? 'Push-ups' : 'Hand-Release', `${upperInput} reps`, upperPts, passedUpper)}
    ${getResultLine(coreChoice === 'plank' ? 'Plank' : (coreChoice === 'situps' ? 'Sit-ups' : 'Reverse Crunch'), coreDisplay, corePts, passedCore)}
    ${getResultLine(`WHtR`, `${whtrInfo.ratio} – ${whtrInfo.category}`, whtrInfo.pts, passedWhtr)}
    <hr>
    <p><strong>Total Score:</strong> ${totalScore.toFixed(1)} pts</p>
    <p class="${isPass ? 'pass' : 'fail'}">
      <strong>Overall Result: ${isPass ? 'PASS' : 'FAIL'}</strong><br>
      <small>${passedComposite ? 'Composite score met.' : 'Composite score not met.'} You must meet all component minimums and achieve a total score of ${PT_DATA.compositeCategories.satisfactoryMin} or higher.</small>
    </p>
  `;
  outputDiv.scrollIntoView({ behavior: 'smooth' });
});
</script>
</body>
</html>

